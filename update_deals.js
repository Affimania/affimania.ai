const fs = require('fs');
const path = require('path');

// --- START: 99 DEALS GENERATE KARNE WALA LOGIC ---
const NUM_DEALS = 99; // Har ghante 99 nayi deals banengi
const realDealsData = [];

for (let i = 1; i <= NUM_DEALS; i++) {
    // Random Price aur MRP set karna
    const price = Math.floor(Math.random() * 8000) + 500;
    const mrp = price + Math.floor(Math.random() * 3000) + 500;

    realDealsData.push({
        // ðŸŸ¢ FIX: Title mein Random Number add kiya gaya hai (Taki Git har baar commit kare)
        title: `Trending Deal (Ref. #${i}) - ${new Date().toLocaleTimeString()} [ID:${Math.random().toFixed(4)}]`,
        price: price,
        mrp: mrp,
        // Savings percentage calculate karna
        savings: `Flat ${Math.round(((mrp - price) / mrp) * 100)}% Off`,
        affiliate_link: `https://www.amazon.in/s?k=Top+Daily+Deal+${i}&tag=ascreation00f-21`,
        image: "https://example.com/placeholder.jpg" // Placeholder image URL
    });
}
// --- END: 99 DEALS GENERATE KARNE WALA LOGIC ---


// Step 1: Deals Array ko JavaScript Code mein Convert karna
const dealsArrayString = JSON.stringify(realDealsData, null, 4);

// Step 2: index.html file ko padhna
const indexPath = path.join(__dirname, 'index.html');
let indexContent = fs.readFileSync(indexPath, 'utf8');

// Step 3: Deals data ko index.html mein inject karna
const startMarker = '// --- START: AUTOGENERATED DEALS DATA ---';
const endMarker = '// --- END: AUTOGENERATED DEALS DATA ---';

const newDealsCode = `const dummyDeals = ${dealsArrayString};`;

if (indexContent.includes(startMarker) && indexContent.includes(endMarker)) {
    // Regex se markers ke beech ka content replace karna
    const regex = new RegExp(`(?<=${startMarker}\\n)[\\s\\S]*?(?=\\n${endMarker})`, 'm');
    indexContent = indexContent.replace(regex, newDealsCode);
    console.log('Deals data successfully injected into index.html');
} else {
    // Agar markers nahi mile toh error dikhana
    console.error('Error: START/END markers not found in index.html. Cannot inject deals.');
}

// Step 4: Updated index.html ko save karna
fs.writeFileSync(indexPath, indexContent, 'utf8');
console.log('index.html updated successfully with new deals!');
