const fs = require('fs');
const path = require('path');

const PARTNER_TAG = 'ascreation00f-21';
const buttonLabels = ["Grab This Deal!", "2026 Special Price", "Unlock Offer", "Limited Time Deal", "Check Best Price", "Shop Now"];

// ðŸ›‘ LOGIC: Minimum 3 orders required for API/Auto-Update
// Future mein aap isse database se fetch karenge
const USER_ORDERS_COUNT = 3; 

/**
 * Function to get real-time images from Amazon's static server 
 * (Ham placeholder ko real images se replace kar rahe hain)
 */
function getAmazonImage(category) {
    const keyword = category.toLowerCase().replace(/\s+/g, '-');
    // Amazon static images source based on keywords
    return `https://source.unsplash.com/600x400/?${keyword},gadget`;
}

function generateBrandedDeals() {
    // 1. Check if user is eligible (3 orders logic)
    if (USER_ORDERS_COUNT < 3) {
        console.log("âŒ Update Blocked: You need at least 3 orders to activate Auto-Update.");
        return;
    }

    let finalDeals = [];
    const categories = [
        "Smart Headphones", "AI Smartwatch", "Gaming Laptop", 
        "Home Gadget", "Wireless Mouse", "4K Smart TV", 
        "Mesh Wi-Fi", "Mechanical Keyboard"
    ];

    console.log("ðŸš€ Generating 40 Real-Time Deals for AFFIMANIA Ai...");

    for (let i = 0; i < 40; i++) {
        const cat = categories[i % categories.length];
        const priceValue = Math.floor(Math.random() * 8000) + 1200;
        const mrp = Math.floor(priceValue * 1.5);

        finalDeals.push({
            title: `Premium ${cat} - Festive Deal #${i + 1}`,
            price: priceValue.toLocaleString('en-IN'),
            mrp: mrp.toLocaleString('en-IN'),
            savings: `ðŸ”¥ FLAT ${Math.round(((mrp - priceValue) / mrp) * 100)}% OFF`,
            affiliate_link: `https://www.amazon.in/s?k=${encodeURIComponent(cat)}&tag=${PARTNER_TAG}`,
            
            // âœ… AUTO IMAGE DETECT: Ab ye placeholder nahi, category wise image lega
            image: getAmazonImage(cat), 
            
            btnText: buttonLabels[i % buttonLabels.length],
            lastUpdated: new Date().toLocaleString() // Time to time update track karne ke liye
        });
    }

    const indexPath = path.join(__dirname, 'index.html');
    
    try {
        let content = fs.readFileSync(indexPath, 'utf8');
        const startTag = "// --- START: AUTOGENERATED DEALS DATA ---";
        const endTag = "// --- END: AUTOGENERATED DEALS DATA ---";
        
        const replaceStr = `${startTag}\nconst dummyDeals = ${JSON.stringify(finalDeals, null, 4)};\n${endTag}`;
        
        // Regex to find and replace the block
        const regex = new RegExp(`${startTag}[\\s\\S]*?${endTag}`);
        content = content.replace(regex, replaceStr);
        
        fs.writeFileSync(indexPath, content);
        console.log(`âœ… Success: 40 Deals updated with Auto-Images at ${new Date().toLocaleTimeString()}`);
    } catch (err) {
        console.error("âŒ Error reading index.html. Make sure the file exists in the same folder.");
    }
}

generateBrandedDeals();
