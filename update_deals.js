const fs = require('fs');
const path = require('path');

// --- 1. DYNAMIC SEASONAL DATABASE ---
const seasonalDatabase = {
    winter: {
        badge: "WINTER SPECIAL â„ï¸",
        title: "Crush Your <span class='text-blue-400'>2026 Goals</span>",
        desc: "Best deals on Fitness Gear, Winter Wear, and Health Essentials.",
        bg: "https://images.unsplash.com/photo-1517836357463-d25dfeac3438?q=80&w=1200",
        accent: "#164E63",
        categories: [
            {n: "Fitness", i: "ğŸ‹ï¸â€â™‚ï¸", l: "fitness+equipment"},
            {n: "Self Help", i: "ğŸ“š", l: "productivity+books"},
            {n: "Gadgets", i: "âŒš", l: "smartwatch"},
            {n: "Health", i: "ğŸ¥—", l: "health+supplements"}
        ]
    },
    summer: {
        badge: "SUMMER SAVINGS â˜€ï¸",
        title: "Beat The <span class='text-yellow-500'>Heat</span>",
        desc: "Cool deals on ACs, Coolers, and Summer Essentials.",
        bg: "https://images.unsplash.com/photo-1507525428034-b723cf961d3e?q=80&w=1200",
        accent: "#F97316",
        categories: [
            {n: "Coolers", i: "ğŸŒ¬ï¸", l: "air+cooler"},
            {n: "Sunscreen", i: "ğŸ§´", l: "sunscreen"},
            {n: "Drinks", i: "ğŸ¹", l: "juicer+mixer"},
            {n: "Clothing", i: "ğŸ‘•", l: "cotton+clothes"}
        ]
    }
};

// --- 2. SELECT CURRENT SEASON ---
const month = new Date().getMonth(); 
const selectedSeason = (month >= 2 && month <= 6) ? seasonalDatabase.summer : seasonalDatabase.winter;

// --- 3. GENERATE 99 TRENDING DEALS ---
const trendingProducts = ["Smartwatch", "Wireless Buds", "Running Shoes", "Backpack", "Gaming Mouse", "Skincare Serum"];
const realDealsData = [];
for (let i = 1; i <= 99; i++) {
    const price = Math.floor(Math.random() * 8000) + 500;
    const mrp = price + Math.floor(Math.random() * 3000) + 500;
    const randomProduct = trendingProducts[Math.floor(Math.random() * trendingProducts.length)];
    realDealsData.push({
        title: `${randomProduct} - Save Today!`,
        price: price,
        mrp: mrp,
        savings: `Flat ${Math.round(((mrp - price) / mrp) * 100)}% Off`,
        affiliate_link: `https://www.amazon.in/s?k=${randomProduct.replace(/\s/g, '+')}&tag=ascreation00f-21`,
        image: "https://placehold.co/150x150?text=AFFIMANIA"
    });
}

// --- 4. INJECT INTO INDEX.HTML ---
const indexPath = path.join(__dirname, 'index.html');
let content = fs.readFileSync(indexPath, 'utf8');

// Inject Deals
content = content.replace(/(\/\/ --- START: AUTOGENERATED DEALS DATA ---)[\s\S]*?(\/\/ --- END: AUTOGENERATED DEALS DATA ---)/, 
    `$1\nconst dummyDeals = ${JSON.stringify(realDealsData, null, 4)};\n$2`);

// Inject Context
content = content.replace(/(\/\/ --- START: CONTEXT DATA ---)[\s\S]*?(\/\/ --- END: CONTEXT DATA ---)/, 
    `$1\nconst affimaniaContext = ${JSON.stringify(selectedSeason)};\n$2`);

fs.writeFileSync(indexPath, content);
console.log('âœ… Affimania AI: Seasonal Engine Updated Successfully!');
